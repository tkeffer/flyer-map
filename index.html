<html>

<head>
    <title>Where is Flyer?</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
    <script type="text/javascript" type="text/javascript">
        let mqtt;
        const reconnectTimeout = 2000;
        const host = "localhost";
        const port = 8080;

        function onFailure(message) {
            console.log("Connection Attempt to Host " + host + "Failed");
            setTimeout(MQTTconnect, reconnectTimeout);
        }

        function onMessageArrived(msg) {
            // Destructure the payload for convenience
            const {payloadString, destinationName} = msg;
            const out_msg = "Message received " + payloadString + " from topic " + destinationName;
            console.log(out_msg);

        }

        function onConnect() {
            // Once a connection has been made, make a subscription and send a message.

            console.log("Connected ");
            // The uuid seems to be changing with every invocation of SignalK, so for now, use a wild card:
            mqtt.subscribe("signalk/+/navigation.position");
        }

        function MQTTconnect() {
            console.log("connecting to " + host + " " + port);
            const x = Math.floor(Math.random() * 10000);
            const cname = "flyer-client-" + x;
            mqtt = new Paho.MQTT.Client(host, port, cname);
            //document.write("connecting to "+ host);
            const options = {
                timeout: 3,
                onSuccess: onConnect,
                onFailure: onFailure,
            };
            mqtt.onMessageArrived = onMessageArrived

            mqtt.connect(options); //connect
        }

    </script>
</head>
<body>
<h1>Where is <i>Flyer</i>?</h1>
<script>
    MQTTconnect();
</script>
</body>
</html>